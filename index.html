<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mapa de Campo Magn√©tico</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #eef4ff;
    color: #111;
    text-align: center;
    padding: 20px;
  }
  h1 { color: #0a3c91; }
  #valor { font-size: 2em; margin: 10px; color: #d43f00; }
  button {
    background: #0a3c91;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    font-size: 1em;
    cursor: pointer;
  }
  button:hover { background: #092e70; }
  canvas {
    margin-top: 20px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
</style>
</head>
<body>

<h1>üß≠ Mapa de Campo Magn√©tico</h1>
<p>Mueve el tel√©fono cerca de objetos met√°licos o imanes y observa c√≥mo cambia el campo.</p>

<div id="valor">Esperando sensor...</div>
<button id="registrar">Registrar medici√≥n</button>

<canvas id="grafico" width="350" height="200"></canvas>

<script>
const valorCampo = document.getElementById("valor");
const btnRegistrar = document.getElementById("registrar");
const canvas = document.getElementById("grafico");
const ctx = canvas.getContext("2d");

let lecturas = [];

if ('Magnetometer' in window) {
  try {
    const sensor = new Magnetometer({frequency: 10});
    sensor.addEventListener('reading', () => {
      const Bx = sensor.x;
      const By = sensor.y;
      const Bz = sensor.z;
      const B = Math.sqrt(Bx*Bx + By*By + Bz*Bz);
      valorCampo.textContent = `${B.toFixed(2)} ¬µT`;
      window.valorActual = B;
    });
    sensor.start();
  } catch (error) {
    valorCampo.textContent = "Sensor no disponible o permisos denegados.";
  }
} else {
  valorCampo.textContent = "Tu navegador no soporta Magnetometer API.";
}

btnRegistrar.addEventListener("click", () => {
  if (window.valorActual) {
    lecturas.push(window.valorActual);
    dibujarGrafico();
  }
});

function dibujarGrafico() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.beginPath();
  ctx.moveTo(20, 180);
  ctx.lineTo(330, 180);
  ctx.strokeStyle = "#333";
  ctx.lineWidth = 1;
  ctx.stroke();

  if (lecturas.length > 0) {
    const max = Math.max(...lecturas);
    ctx.beginPath();
    lecturas.forEach((val, i) => {
      const x = 20 + i * (310 / Math.max(lecturas.length - 1, 1));
      const y = 180 - (val / max) * 160;
      if (i === 0) ctx.moveTo(x, y);
      else ctx.lineTo(x, y);
    });
    ctx.strokeStyle = "#0a3c91";
    ctx.lineWidth = 2;
    ctx.stroke();
  }
}
</script>

</body>
</html>
